---
import BaseLayout from "../layouts/BaseLayout.astro";
import { getAllProjects } from "../data/projectFunctions";
import { ProjectCategory } from "../data/projects";
import type { Project } from "../data/projects";

const pageTitle = "Portfolio";
const allProjects = getAllProjects();

// Group projects by category
const groupedProjects = allProjects.reduce<Record<ProjectCategory, Project[]>>(
    (projectsByCategory, project) => {
        if (!projectsByCategory[project.category]) {
            projectsByCategory[project.category] = [];
        }
        projectsByCategory[project.category].push(project);
        return projectsByCategory;
    },
    {} as Record<ProjectCategory, Project[]>,
);

// Category configuration remains the same
const categoryConfig = {
    [ProjectCategory.Software]: {
        color: "bg-blue-50 text-blue-900 border-blue-200",
        icon: "ðŸ’»",
        ariaLabel: "Software Development Project",
    },
    [ProjectCategory.Music]: {
        color: "bg-purple-50 text-purple-900 border-purple-200",
        icon: "ðŸŽµ",
        ariaLabel: "Music Production Project",
    },
    [ProjectCategory.Education]: {
        color: "bg-green-50 text-green-900 border-green-200",
        icon: "ðŸ“š",
        ariaLabel: "Educational Project",
    },
};
---

<BaseLayout pageTitle={pageTitle}>
    <main class="max-w-4xl mx-auto px-4">
        <section class="mb-16">
            <p class="text-xl leading-relaxed text-gray-800 font-light">
                Welcome to my project portfolio, where I share my work across
                three distinct domains: software development, music creation,
                and educational content. While these areas sometimes intersect
                in projects like Piano Fitness, which bridges software
                development and music education, each domain represents its own
                complete body of work. Here you'll find everything from ambient
                electronic albums and traditional piano compositions to
                educational programming resources and innovative software tools.
                Each project tells its own story of creative exploration,
                technical innovation, or educational impact.
            </p>
        </section>

        {
            Object.entries(groupedProjects).map(([category, projects]) => {
                const categoryDetails =
                    categoryConfig[category as ProjectCategory];
                return (
                    <section
                        class="mb-16"
                        aria-labelledby={`${category}-projects-heading`}
                    >
                        <h2
                            id={`${category}-projects-heading`}
                            class="text-3xl font-semibold mb-8 text-gray-900 border-b pb-4"
                        >
                            <span aria-hidden="true">
                                {categoryDetails.icon}
                            </span>{" "}
                            {category.charAt(0).toUpperCase() +
                                category.slice(1)}{" "}
                            Projects
                        </h2>

                        <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-2">
                            {projects.map((project: Project) => (
                                <article
                                    class="border border-gray-200 rounded-xl p-6 hover:shadow-lg transition-all duration-300 ease-in-out bg-white"
                                    aria-labelledby={`project-${project.title.toLowerCase().replace(/\s+/g, "-")}`}
                                >
                                    <header class="mb-4">
                                        <div class="flex items-center justify-between mb-3">
                                            <span
                                                class={`inline-flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium border ${categoryDetails.color}`}
                                                aria-label={
                                                    categoryDetails.ariaLabel
                                                }
                                            >
                                                <span aria-hidden="true">
                                                    {categoryDetails.icon}
                                                </span>
                                                {project.category}
                                            </span>
                                            <time
                                                datetime={project.datePublished}
                                                class="text-sm text-gray-500"
                                            >
                                                {new Date(
                                                    project.datePublished,
                                                ).toLocaleDateString("en-US", {
                                                    month: "short",
                                                    year: "numeric",
                                                })}
                                            </time>
                                        </div>

                                        <h3
                                            id={`project-${project.title.toLowerCase().replace(/\s+/g, "-")}`}
                                            class="text-xl font-semibold text-gray-900 mb-2 leading-tight"
                                        >
                                            <a
                                                href={project.url}
                                                class="hover:text-blue-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 rounded"
                                            >
                                                {project.title}
                                            </a>
                                        </h3>
                                    </header>

                                    <p class="text-gray-600 mb-6 leading-relaxed">
                                        {project.description}
                                    </p>

                                    {project.tags && (
                                        <footer class="flex flex-wrap gap-2">
                                            {project.tags.map((tag) => (
                                                <span class="bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-sm font-medium hover:bg-gray-200 transition-colors">
                                                    {tag}
                                                </span>
                                            ))}
                                        </footer>
                                    )}
                                </article>
                            ))}
                        </div>
                    </section>
                );
            })
        }
    </main>

    <style>
        /* Enhance focus styles for keyboard navigation */
        a:focus-visible {
            outline: 2px solid currentColor;
            outline-offset: 2px;
        }

        /* Ensure consistent card heights */
        article {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        /* Improve text readability */
        p {
            font-size: 1.125rem;
            line-height: 1.75;
        }
    </style>
</BaseLayout>
