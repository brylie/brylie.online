---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

// Get all blog posts
const allPosts = await getCollection("blog");
const postTags = [...new Set(allPosts.map((post) => post.data.tags).flat())];

// Get all projects
const allProjects = await getCollection("projects");
const projectTags = [
  ...new Set(allProjects.map((project) => project.data.tags || []).flat()),
];

// Get all technologies from projects
const projectTechnologies = [
  ...new Set(
    allProjects.map((project) => project.data.technologies || []).flat(),
  ),
];

// Combine all tags and technologies, removing duplicates, then sort case-insensitive
const allTags = [
  ...new Set([...postTags, ...projectTags, ...projectTechnologies]),
].sort((a, b) => a.toLowerCase().localeCompare(b.toLowerCase()));

const pageTitle = "Tags & Technologies";
---

<BaseLayout pageTitle={pageTitle}>
  <div class="max-w-4xl mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold mb-6">
      Browse Content by Tags & Technologies
    </h1>

    <p class="mb-6 text-lg text-gray-700">
      Click on a tag to see all blog posts and projects related to that topic or
      technology.
    </p>

    <div class="tags flex flex-wrap gap-2">
      {
        allTags.map((tag) => (
          <a
            href={`/tags/${tag}`}
            class="tag px-4 py-2 bg-blue-200 hover:bg-blue-500 hover:text-gray-100 rounded-full transition-colors"
          >
            {tag}
          </a>
        ))
      }
    </div>
  </div>

  <style>
    .tags {
      margin: 2rem 0;
    }
  </style>
</BaseLayout>
